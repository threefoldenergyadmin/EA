<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Energy Assessment for </title>
  <link rel="stylesheet" href="../styles.css">
</head>
<body>
  <div class="page">
    <header class="page-header">
      <div class="brand">Threefold Energy Assessment</div>
      <div class="meta">
        <div>Created </div>
        <div>MPAN </div>
      </div>
    </header>
    <section class="hero">
      <div>
        <p class="eyebrow">Site</p>
        <h1></h1>
        <p class="address"></p>
        <div class="pill-row">
          <span class="pill"></span>
          <span class="pill">Contract ends </span>
          <span class="pill">GSP </span>
        </div>
      </div>
      <div class="key-stat">
        <div class="label">Annual Consumption</div>
        <div class="value"></div>
        <div class="sublabel">kWh over  days ()</div>
      </div>
    </section>

    <section class="summary-grid">
      <div class="summary-card highlight">
        <p class="eyebrow">Current bill</p>
        <div class="stat"></div>
      </div>
      <div class="summary-card highlight">
        <p class="eyebrow">Optima bill</p>
        <div class="stat"></div>
      </div>
      <div class="summary-card">
        <p class="eyebrow">Savings</p>
        <div class="stat"></div>
        <div class="muted"> vs current</div>
      </div>
      <div class="summary-card">
        <p class="eyebrow">Dynamic forecast</p>
        <div class="stat"></div>
        <div class="muted"> savings</div>
      </div>
    </section>

    <section class="two-col">
      <div>
        <h2>Recommended system</h2>
        <ul class="list">
          <li><span class="label">System</span><span class="value"></span></li>
          <li><span class="label">Power</span><span class="value"></span></li>
          <li><span class="label">Capacity</span><span class="value"></span></li>
          <li><span class="label">Capital cost</span><span class="value"></span></li>
        </ul>
      </div>
      <div>
        <h2>Finance headline</h2>
        <div class="finance-callout">
          <div>
            <div class="eyebrow">ROI incl. full expensing</div>
            <div class="stat"></div>
          </div>
          <div>
            <div class="eyebrow">Forecast savings</div>
            <div class="stat"></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div class="page">
    <header class="page-header">
      <div class="brand">Threefold Energy Assessment</div>
      <div class="meta">
        <div>Site </div>
        <div>MPAN </div>
      </div>
    </header>

    <section class="panel">
      <h2>Load profile</h2>
      <div class="profile-grid">
        <div>
          <h3>Current</h3>
          <ul class="list">
            <li><span class="label">Day</span><span class="value"></span></li>
            <li><span class="label">Night</span><span class="value"></span></li>
            <li><span class="label">Red</span><span class="value"></span></li>
            <li><span class="label">Amber</span><span class="value"></span></li>
            <li><span class="label">Green</span><span class="value"></span></li>
            <li><span class="label">Capacity</span><span class="value"></span></li>
          </ul>
        </div>
        <div>
          <h3>Optima</h3>
          <ul class="list">
            <li><span class="label">Day</span><span class="value"></span></li>
            <li><span class="label">Night</span><span class="value"></span></li>
            <li><span class="label">Red</span><span class="value"></span></li>
            <li><span class="label">Amber</span><span class="value"></span></li>
            <li><span class="label">Green</span><span class="value"></span></li>
            <li><span class="label">Capacity</span><span class="value"></span></li>
          </ul>
        </div>
      </div>
    </section>

    <section class="panel two-col">
      <div>
        <h2>Tariffs (current)</h2>
        <ul class="list">
          <li><span class="label">Day</span><span class="value"> p/kWh</span></li>
          <li><span class="label">Night</span><span class="value"> p/kWh</span></li>
          <li><span class="label">Peak</span><span class="value"> p/kWh</span></li>
          <li><span class="label">Standing</span><span class="value"> p/day</span></li>
          <li><span class="label">Availability</span><span class="value"> p/kVA/day</span></li>
          <li><span class="label">CCL</span><span class="value"> p/kWh</span></li>
        </ul>
      </div>
      <div>
        <h2>Tariffs (optima)</h2>
        <ul class="list">
          <li><span class="label">Day</span><span class="value"> p/kWh</span></li>
          <li><span class="label">Night</span><span class="value"> p/kWh</span></li>
          <li><span class="label">Peak</span><span class="value"> p/kWh</span></li>
          <li><span class="label">Standing</span><span class="value"> p/day</span></li>
          <li><span class="label">Availability</span><span class="value"> p/kVA/day</span></li>
          <li><span class="label">CCL</span><span class="value"> p/kWh</span></li>
        </ul>
      </div>
    </section>

    <section class="panel finance-strip">
      <div class="strip-heading">
        <div class="eyebrow">Finance summary</div>
        <div class="stat"></div>
      </div>
      <div class="strip-grid">
        <div><span class="label">Term</span><span class="value"></span></div>
        <div><span class="label">Interest</span><span class="value"></span></div>
        <div><span class="label">Repayment</span><span class="value"></span></div>
        <div><span class="label">Deposit</span><span class="value"></span></div>
        <div><span class="label">VAT</span><span class="value"></span></div>
        <div><span class="label">Estimated price</span><span class="value"></span></div>
      </div>
    </section>
  </div>

  <div class="page">
    <header class="page-header">
      <div class="brand">Threefold Energy Assessment</div>
      <div class="meta">
        <div>Site </div>
        <div>MPAN </div>
      </div>
    </header>

    <section class="panel">
      <div class="panel-heading">
        <div>
          <p class="eyebrow">Annual energy cost by band</p>
          <h2>Current vs optima</h2>
        </div>
        <div class="legend">
          <span class="legend-item"><span class="dot current"></span>Current</span>
          <span class="legend-item"><span class="dot optima"></span>Optima</span>
        </div>
      </div>
      <div class="chart" id="chart-a" aria-label="Annual energy cost chart"></div>
      <table class="data-table">
        <thead>
          <tr><th>Band</th><th>Tariff (p/kWh)</th><th>Cost current</th><th>Cost optima</th></tr>
        </thead>
        <tbody>
          <tr><td>Day</td><td></td><td></td><td></td></tr>
          <tr><td>Night</td><td></td><td></td><td></td></tr>
          <tr><td>Red</td><td></td><td></td><td></td></tr>
          <tr><td>Amber</td><td></td><td></td><td></td></tr>
          <tr><td>Green</td><td></td><td></td><td></td></tr>
        </tbody>
      </table>
    </section>

    <section class="panel">
      <div class="panel-heading">
        <div>
          <p class="eyebrow">Forecasted savings</p>
          <h2>Scenario comparison</h2>
        </div>
      </div>
      <div class="chart" id="chart-b" aria-label="Savings trajectory chart"></div>
      <table class="data-table compact">
        <thead>
          <tr>
            <th colspan="2">Purchase</th>
            <th colspan="2">Finance</th>
            <th colspan="3">Dynamic</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Year 1</td><td></td><td>Year 1</td><td></td><td>Year 1</td><td colspan="2"></td></tr>
          <tr><td>Warranty</td><td></td><td>Warranty</td><td></td><td>Forecast</td><td colspan="2"></td></tr>
          <tr><td>Useful life</td><td></td><td>Useful life</td><td></td><td>ROI ex full expensing</td><td colspan="2"></td></tr>
          <tr><td>ROI ex full expensing</td><td></td><td>ROI ex full expensing</td><td></td><td>ROI inc full expensing</td><td colspan="2"></td></tr>
          <tr><td>ROI inc full expensing</td><td></td><td>ROI inc full expensing</td><td></td><td>Full expensing value</td><td colspan="2"></td></tr>
          <tr><td>Basic ROI</td><td></td><td>Finance payment</td><td></td><td colspan="2">Finance total</td><td></td></tr>
        </tbody>
      </table>
    </section>
  </div>

  <div class="page">
    <header class="page-header">
      <div class="brand">Threefold Energy Assessment</div>
      <div class="meta">
        <div>Site </div>
        <div>MPAN </div>
      </div>
    </header>

    <section class="panel">
      <h2>Important information</h2>
      <p class="disclaimer">This report is based on the supplied consumption profile and tariff information. Savings are indicative and subject to final engineering design, site surveys, and prevailing market conditions. Finance illustrations are for guidance only and may vary. Please refer to your agreement for full terms and conditions.</p>
      <div class="callout muted">
        <div>
          <div class="eyebrow">Annual savings</div>
          <div class="stat"></div>
        </div>
        <div>
          <div class="eyebrow">Dynamic savings</div>
          <div class="stat"></div>
        </div>
        <div>
          <div class="eyebrow">ROI</div>
          <div class="stat"></div>
        </div>
      </div>
    </section>
  </div>

  <script id="chart-data" type="application/json">
  {
    "costBands": {
      "labels": ["Day","Night","Red","Amber","Green"],
      "current": [0,0,0,0,0],
      "optima": [0,0,0,0,0]
    },
    "chartYears": ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],
    "chartSeries": {
      "finance_payment": [],
      "finance_optima_cum_savings": [],
      "finance_dynamic_forecast_savings": [],
      "purchase_optima_cum_savings": [],
      "purchase_dynamic_forecast_savings": []
    }
  }
  </script>
  <script>
    function parseChartData() {
      const el = document.getElementById('chart-data');
      if (!el) return null;
      try {
        return JSON.parse(el.textContent);
      } catch (err) {
        console.error('Invalid chart data', err);
        return null;
      }
    }

    function renderCostBands(data) {
      const container = document.getElementById('chart-a');
      if (!container || !data) return;
      const labels = data.costBands.labels || [];
      const current = data.costBands.current || [];
      const optima = data.costBands.optima || [];
      const width = container.clientWidth || 700;
      const height = 280;
      const padding = { top: 20, right: 20, bottom: 40, left: 60 };
      const maxValue = Math.max(...current, ...optima, 1);
      const barWidth = (width - padding.left - padding.right) / labels.length / 2 - 10;

      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
      svg.setAttribute('role', 'img');
      svg.classList.add('svg-chart');

      labels.forEach((label, i) => {
        const xBase = padding.left + i * ((width - padding.left - padding.right) / labels.length);
        const currentHeight = (current[i] || 0) / maxValue * (height - padding.top - padding.bottom);
        const optimaHeight = (optima[i] || 0) / maxValue * (height - padding.top - padding.bottom);

        const currentRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        currentRect.setAttribute('x', xBase);
        currentRect.setAttribute('y', height - padding.bottom - currentHeight);
        currentRect.setAttribute('width', barWidth);
        currentRect.setAttribute('height', currentHeight);
        currentRect.setAttribute('class', 'bar current');
        svg.appendChild(currentRect);

        const optimaRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        optimaRect.setAttribute('x', xBase + barWidth + 10);
        optimaRect.setAttribute('y', height - padding.bottom - optimaHeight);
        optimaRect.setAttribute('width', barWidth);
        optimaRect.setAttribute('height', optimaHeight);
        optimaRect.setAttribute('class', 'bar optima');
        svg.appendChild(optimaRect);

        const labelText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        labelText.setAttribute('x', xBase + barWidth);
        labelText.setAttribute('y', height - padding.bottom + 20);
        labelText.setAttribute('text-anchor', 'middle');
        labelText.setAttribute('class', 'axis-label');
        labelText.textContent = label;
        svg.appendChild(labelText);
      });

      for (let i = 0; i <= 4; i++) {
        const value = maxValue * i / 4;
        const y = height - padding.bottom - (height - padding.top - padding.bottom) * i / 4;
        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line.setAttribute('x1', padding.left - 10);
        line.setAttribute('x2', width - padding.right);
        line.setAttribute('y1', y);
        line.setAttribute('y2', y);
        line.setAttribute('class', 'grid-line');
        svg.appendChild(line);

        const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        text.setAttribute('x', padding.left - 15);
        text.setAttribute('y', y + 4);
        text.setAttribute('text-anchor', 'end');
        text.setAttribute('class', 'axis-label');
        text.textContent = `£${value.toLocaleString(undefined, { maximumFractionDigits: 0 })}`;
        svg.appendChild(text);
      }

      container.innerHTML = '';
      container.appendChild(svg);
    }

    function renderSavingsChart(data) {
      const container = document.getElementById('chart-b');
      if (!container || !data) return;
      const years = data.chartYears || [];
      const series = data.chartSeries || {};
      const width = container.clientWidth || 700;
      const height = 300;
      const padding = { top: 20, right: 20, bottom: 40, left: 60 };
      const seriesNames = Object.keys(series);
      const colors = {
        finance_payment: '#1F6FEB',
        finance_optima_cum_savings: '#1DD1A1',
        finance_dynamic_forecast_savings: '#00B894',
        purchase_optima_cum_savings: '#6C5CE7',
        purchase_dynamic_forecast_savings: '#E17055'
      };

      let maxValue = 1;
      seriesNames.forEach((name) => {
        (series[name] || []).forEach((v) => {
          if (v !== null && v !== undefined) {
            maxValue = Math.max(maxValue, Number(v));
          }
        });
      });

      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
      svg.setAttribute('role', 'img');
      svg.classList.add('svg-chart');

      const plotWidth = width - padding.left - padding.right;
      const plotHeight = height - padding.top - padding.bottom;

      function xPos(i) {
        return padding.left + (plotWidth / Math.max(years.length - 1, 1)) * i;
      }
      function yPos(v) {
        const val = Number(v || 0);
        return padding.top + plotHeight - (val / maxValue) * plotHeight;
      }

      for (let i = 0; i <= 4; i++) {
        const value = maxValue * i / 4;
        const y = yPos(value);
        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line.setAttribute('x1', padding.left);
        line.setAttribute('x2', width - padding.right);
        line.setAttribute('y1', y);
        line.setAttribute('y2', y);
        line.setAttribute('class', 'grid-line');
        svg.appendChild(line);

        const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        text.setAttribute('x', padding.left - 10);
        text.setAttribute('y', y + 4);
        text.setAttribute('text-anchor', 'end');
        text.setAttribute('class', 'axis-label');
        text.textContent = `£${value.toLocaleString(undefined, { maximumFractionDigits: 0 })}`;
        svg.appendChild(text);
      }

      years.forEach((year, i) => {
        const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        text.setAttribute('x', xPos(i));
        text.setAttribute('y', height - padding.bottom + 20);
        text.setAttribute('text-anchor', 'middle');
        text.setAttribute('class', 'axis-label');
        text.textContent = year;
        svg.appendChild(text);
      });

      seriesNames.forEach((name) => {
        const values = series[name] || [];
        const pathParts = [];
        values.forEach((v, i) => {
          if (v === null || v === undefined || v === '' || Number.isNaN(Number(v))) return;
          const x = xPos(i);
          const y = yPos(v);
          pathParts.push(`${pathParts.length === 0 ? 'M' : 'L'}${x},${y}`);
        });
        if (!pathParts.length) return;
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', pathParts.join(' '));
        path.setAttribute('fill', 'none');
        path.setAttribute('stroke', colors[name] || '#888');
        path.setAttribute('stroke-width', '3');
        svg.appendChild(path);
      });

      container.innerHTML = '';
      container.appendChild(svg);
    }

    const chartData = parseChartData();
    renderCostBands(chartData);
    renderSavingsChart(chartData);
  </script>
</body>
</html>
